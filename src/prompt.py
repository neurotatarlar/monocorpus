from google.genai.errors import ClientError
from google.genai import types
import io
import datetime
from prepare_shots import load_inline_shots
import json

cooked_shots_dir = "./shots/cooked"

# SYSTEM_PROMPT="""
# You are an expert assistant specializing in processing Tatar-language documents written in Cyrillic script.
# You perform two types of tasks based on the user‚Äôs instruction:

# 1. Structured Content Extraction:
# - Extract and format the document‚Äôs main content into Markdown with some embedded HTML.
# - Focus on preserving the structure: paragraphs, headings, tables, formulas, images, footnotes, subscripts, and tables of contents.
# - Do not translate, summarize, or rewrite the original text.
# - Maintain natural reading order and document flow.
# - Handle content that spans pages (e.g., continuing paragraphs, tables).
# - Maintain the natural reading order throughout the document.

# 2. Metadata Extraction:
# - Extract metadata (such as title, author, language, publisher, publication date) by analyzing the first few and last few pages of the document.
# - Return metadata structured in Schema.org format as valid JSON-LD.
# - When information is missing, leave fields blank or omit them.
# - Do not invent information that does not exist in the document.
# - Language of metadata values must remain in original Tatar language unless otherwise specified.

# In both tasks:
# - Be precise, structured, and careful.
# - Prioritize accuracy and document integrity over speculation or creativity.
# - Never translate, summarize, or paraphrase unless explicitly requested.
# """

EXTRACT_CONTENT_PROMPT_PRELUDE = '''
# CONTEXT
pages_from = {_from}
pages_to = {_to}
next_footnote_num = {next_footnote_num}
{headers_hierarchy}

# TASK: STRUCTURED_CONTENT

You are extracting structured content from a specific range of pages in a PDF document written in the Tatar language. The page range is defined by the `pages_from` and `pages_to` values above (inclusive), and refers to the actual page indices in the PDF (not printed page numbers).

Your task is to return a cleaned and structured version of the selected content, formatted in Markdown + HTML, and wrapped under the "content" key of a JSON object.
'''.strip()

EXTRACT_CONTENT_PROMPT_STATIC_BODY = """
1. Remove all headers, footers, and page numbers.
   - These often appear at the top/bottom and may include titles, author names, dates, or printed page numbers.
   - Do **not** confuse genuine section headings with headers.

2. Preserve and structure the main content
   - Keep paragraphs intact and merge broken lines into full sentences.
   - Insert an empty line between paragraphs for readability.
   - Recognize section titles/headings and format them using Markdown headers.
   - Maintain natural reading order.
   - Do **not** translate, rewrite, or omit any legitimate content.

3. Dehyphenate words across line breaks
   - Join words only if a hyphen occurs at the end of a line and the next line begins with its continuation.  
   Example: `–º”ô–¥”ô-\n–Ω–∏”ô—Ç` ‚Üí `–º”ô–¥”ô–Ω–∏—è—Ç`
   - Do **not** merge regular hyphenated words within a line.

4. Apply Markdown formatting
   - Use:
      - `**bold**`
      - `*italic*`
      - `***bold italic***`
   - Only apply formatting if it is clearly visible in the source.
   - Do **not** guess or apply formatting arbitrarily.


5. Format tables using HTML
   - Use `<table>` to format recognized tables.
   - Preserve clarity and structure.
   - Continue tables across page breaks when needed.
   - If a Table of Contents is detected (list of sections and page numbers), do not process its links, page numbers, or headers individually. Instead, preserve its look as a single block using 
   ```html
   <table class="toc"></table>
   ```

6. Detect and format mathematical, physical, or chemical formulas:
   - If a formula is recognized (inline or display), format using LaTeX:
     - Inline formulas: `$...$`
     - Displayed (block) formulas: `$$...$$`
   - Format subscripts as:
      - Scientific context ‚Üí LaTeX: $H_2O$
      - Non-scientific/stylistic (e.g. indices) ‚Üí HTML: <sub>...</sub>

7. Detect and format images:
   - Insert images using:
      ```html
      <figure data-bbox="[y_min, x_min, y_max, x_max]" data-page="10"></figure>
      ```
   - The `data-bbox` attribute should contain the bounding box of the image in the following format: `[y_min, x_min, y_max, x_max]`.
     - These coordinates are normalized values between `0` and `1000`.
     - The top-left corner of the page is the origin `(0, 0)`, where:
       - `y_min`: vertical coordinate of the top edge
       - `x_min`: horizontal coordinate of the left edge
       - `y_max`: vertical coordinate of the bottom edge
       - `x_max`: horizontal coordinate of the right edge
     - For example, `[100, 150, 300, 450]` means the image starts 100 units from the top, 150 units from the left, and extends to 300 units down and 450 units across.
   - If a caption is present, format it inside `<figcaption>`, for example:
      ```html
      <figure data-bbox="[100, 150, 300, 450]"><figcaption>–†”ô—Å–µ–º 5</figcaption></figure>
     ```
   - The `data-page` attribute is exact index in the full PDF (not visible printed page number).
      - The first page you are analyzing might be page 50 in the full document. If so, that is `data-page="50"`.
      - **Ignore visible page numbers in the book itself**. Always use the sequential PDF document index.
   - ‚ö†Ô∏è If the image is located inside a paragraph (e.g., between lines mid-sentence), do not interrupt the paragraph. ‚ùå Do not insert the image inline in the middle of the paragraph. Instead:
      - Logically split the paragraph into two parts around the image.
      - Place the <figure> after the full paragraph (i.e., append it).
      - Join the paragraph back into a clean, uninterrupted block of text.
      Example Input (detected image between lines):
      ```markdwon
      –ö–µ—à–µ–ª”ô—Ä –º–µ“£—ä–µ–ª–ª—ã–∫–ª–∞—Ä –¥”ô–≤–∞–º—ã–Ω–¥–∞  
      [DETECTED IMAGE]  
      —Ç–∞–±–∏–≥–∞—Ç—å –±–µ–ª”ô–Ω –≥–∞—Ä–º–æ–Ω–∏—è–¥”ô —è—à”ô–≥”ô–Ω–Ω”ô—Ä.
      ```
      ‚úÖ Correct Output:
      ```markdown
      –ö–µ—à–µ–ª”ô—Ä –º–µ“£—ä–µ–ª–ª—ã–∫–ª–∞—Ä –¥”ô–≤–∞–º—ã–Ω–¥–∞ —Ç–∞–±–∏–≥–∞—Ç—å –±–µ–ª”ô–Ω –≥–∞—Ä–º–æ–Ω–∏—è–¥”ô —è—à”ô–≥”ô–Ω–Ω”ô—Ä.

      <figure data-bbox="[100,150,300,450]" data-page="12"><figcaption>–†”ô—Å–µ–º 5</figcaption></figure>
      ```
   - If the image is purely decorative (e.g., background ornament), omit it.

8. Format lists
   - Use Markdown bullets (`-`) or numbers (`1.`, `2.`, etc.).
   - Detect and format multi-level lists correctly, preserving indentation and hierarchy.
   Example:
   ```markdown
   - First level
      - Second level
         1. Numbered list inside
   ```
9. Text inside images
   - If there is textual content inside an image, do not extract it.
   - Only represent the image, not its internal text.

10. Continuations across pages
   - If the first paragraph of the current page is a direct continuation from the previous page (i.e., the sentence or word continues across the page break), merge them into one paragraph **without inserting a line break or blank line**.
   - If a table continues from a previous page, continue it without restarting.
   - Apply the same rule for continued tables or formulas.

11. Page Numbering rules:
   - The input slice come from an arbitrary range of the full PDF document (e.g., pages 50‚Äì99).
   - Each page in the input corresponds to its **PDF document index**, starting from the specified number (e.g., first page = 50, second = 51, etc.).
   - Use these PDF indices when referencing pages ‚Äî especially in `data-page` attributes for images.
   - **Do not rely on or mention the printed page numbers inside the scanned document.** Even if a page shows a visible number like "Page 3", ignore it. Use only the sequential index starting from PDF page ${_from} as described.
   - Always use the PDF document index (e.g., page 50, 51, 52...) for data-page, not any printed number shown on the page.
   - Assume the first page provided corresponds to ${_from}.
   - Use this logic for referencing page numbers in images or figure tags.
   
12. Language
   - The document is written in Tatar using the Zamanalif variant of Latin script. This alphabet is the same as common turkic alphabet.
   - Be cautious not to delete or alter meaningful Tatar-language content.

13. Output format
   - Return a JSON object:
   ```json
   {{
      "content": "..."
   }}
   ```
14. General requirements:
   - Output a clean, continuous version of the document, improving structure and readability.
   - Do not translate, rewrite, or modify the original Tatar text.
   - The document language is Tatar, written in Zamanalif tatar script.
   - Be careful not to accidentally remove important content.
""".strip()

EXTRACT_CONTENT_PROMPT_FOOTNOTE_PART = """
15. Detect and mark footnotes:
   - Maintain global sequential numbering for footnotes starting from {next_footnote_num}: [^{next_footnote_num}]
   - Detect footnotes whether marked by numbers (e.g., 1), symbols (*, ‚Ä†, etc.), or superscripts (<sup>). Normalize all to numbered [^\\d+] format starting from {next_footnote_num}.
   - When you encounter the footnote text, convert it to a standard Markdown footnote definition on a new line:
      ```markdown
      [^1]: This is the text of the first footnote.
      [^2]: This is the text of the second footnote.
      ```
   - üßæ If footnote texts appear only at the end of the book, treat that section as a footnote glossary - match each footnote to its marker in order of appearance or by matching content when possible. Apply the same global numbering and format as above.
   - Do **not** treat subscripted or superscripted numbers or symbols inside mathematical, physical, or chemical formulas as footnotes. For example, do not convert $H_2O$ or $x^2$ into footnotes. Footnotes should only be detected when:
      - The marker (number, asterisk, or symbol) appears outside any inline or block LaTeX/math context.
      - The marker is not part of a scientific term, chemical formula, or equation.
   When in doubt, prefer LaTeX formatting for anything inside formulas or expressions.
   - ‚ö†Ô∏è Important: If the footnote text appears in the middle of a paragraph, list, or table (e.g., due to page breaks or layout quirks), insert the footnote text definitions before the paragraph, list, or table and only then complete the splitted paragraph, list, or table naturally, without breaks.
   Example:
   Input:
   ```
   –ê–Ω—ã“£ —Ñ–æ–ª—å–∫–ª–æ—Ä–≥–∞[^1], —Ç–µ–ª “ª”ô–º ”ô–¥”ô–±–∏—è—Ç –±–µ–ª–µ–º–µ–Ω”ô,
   ”ô–¥”ô–±–∏ —Ç”ô–Ω–∫—ã–π—Ç—å–∫”ô –∫–∞—Ä–∞–≥–∞–Ω —Ñ”ô–Ω–Ω–∏ —Ö–µ–∑–º”ô—Ç–ª”ô—Ä–µ 
   —Ç—é—Ä–∫–æ–ª–æ–≥–∏—è–¥”ô –ù”ô–∫—ã–π –ò—Å”ô–Ω–±”ô—Ç[^2] –¥–∏–≥”ô–Ω –≥–∞–ª–∏–º –∏—Å–µ–º–µ–Ω –∫–∞–∫—à–∞-
   ---
   <sup>1</sup> –ù. –ò—Å”ô–Ω–±”ô—Ç–Ω–µ“£ —à”ô—Ö—Å–∏ –∞—Ä—Ö–∏–≤—ã: –ù. –ò—Å”ô–Ω–±”ô—Ç–Ω–µ“£ –°. –ö—É–¥–∞—à–∫–∞ —è–∑–≥–∞–Ω
   —Ö–∞—Ç—ã–Ω–Ω–∞–Ω. 
   <sup>2</sup> –ù. –ò—Å”ô–Ω–±”ô—Ç–Ω–µ“£ —à”ô—Ö—Å–∏ –∞—Ä—Ö–∏–≤—ã: ”ò—Ö–º”ô–¥—É–ª–ª–∏–Ω –ê. 
   ---
   –º–∞—Å –∏—Ç”ô (–ú. –ì–∞–ª–∏–µ–≤, –§. –ì–∞–Ω–∏–µ–≤, –ú. –ì–æ—Å–º–∞–Ω–æ–≤, ”ò. –ï–Ω–∏–∫–∏,
   –ú. –ú”ô“ª–¥–∏–µ–≤, –• –ú”ô—Ö–º“Ø—Ç–æ–≤, –ì. –†”ô—Ö–∏–º, –°. –°–∞—Ñ—É–∞–Ω–æ–≤, –ë. –£—Ä–º–∞–Ω—á–µ, 
   –°. –•”ô–∫–∏–º “ª.–±.).
   ```
   Output (given last global footnote number was 35):
   ```
   [^36]: –ù. –ò—Å”ô–Ω–±”ô—Ç–Ω–µ“£ —à”ô—Ö—Å–∏ –∞—Ä—Ö–∏–≤—ã: –ù. –ò—Å”ô–Ω–±”ô—Ç–Ω–µ“£ –°. –ö—É–¥–∞—à–∫–∞ —è–∑–≥–∞–Ω —Ö–∞—Ç—ã–Ω–Ω–∞–Ω.
   [^37]: –ù. –ò—Å”ô–Ω–±”ô—Ç–Ω–µ“£ —à”ô—Ö—Å–∏ –∞—Ä—Ö–∏–≤—ã: ”ò—Ö–º”ô–¥—É–ª–ª–∏–Ω –ê.
   
   –ê–Ω—ã“£ —Ñ–æ–ª—å–∫–ª–æ—Ä–≥–∞[^36], —Ç–µ–ª “ª”ô–º ”ô–¥”ô–±–∏—è—Ç –±–µ–ª–µ–º–µ–Ω”ô, ”ô–¥”ô–±–∏ —Ç”ô–Ω–∫—ã–π—Ç—å–∫”ô –∫–∞—Ä–∞–≥–∞–Ω —Ñ”ô–Ω–Ω–∏ —Ö–µ–∑–º”ô—Ç–ª”ô—Ä–µ —Ç—é—Ä–∫–æ–ª–æ–≥–∏—è–¥”ô –ù”ô–∫—ã–π –ò—Å”ô–Ω–±”ô—Ç[^37] –¥–∏–≥”ô–Ω –≥–∞–ª–∏–º –∏—Å–µ–º–µ–Ω –∫–∞–∫—à–∞–º–∞—Å –∏—Ç”ô (–ú. –ì–∞–ª–∏–µ–≤, –§. –ì–∞–Ω–∏–µ–≤, –ú. –ì–æ—Å–º–∞–Ω–æ–≤, ”ò. –ï–Ω–∏–∫–∏, –ú. –ú”ô“ª–¥–∏–µ–≤, –• –ú”ô—Ö–º“Ø—Ç–æ–≤, –ì. –†”ô—Ö–∏–º, –°. –°–∞—Ñ—É–∞–Ω–æ–≤, –ë. –£—Ä–º–∞–Ω—á–µ, –°. –•”ô–∫–∏–º “ª.–±.).
   ```
""".strip()

EXTRACT_CONTENT_PROMPT_POSSIBLE_TITLE = """
16. Document may contain a main title. If you detect a main document title mark it with a single #. Use ## for top-level sections, ### for subsections, and so on. Always preserve the heading hierarchy based on the document's logical structure.
""".strip()

EXTRACT_CONTENT_PROMPT_NO_TITLE = """
16. Document does not have a title page, so never use a single #. Always preserve the heading hierarchy based on the document's logical structure. Current headers hierarchy you can find in the `headers_hierarchy` value. Continue the structure above consistently in this chunk. Do not restart or re-level headings. If a new chapter begins, continue from the next logical chapter number.
""".strip()

DEFINE_META_PROMPT_PDF_HEADER = """
# TASK: METADATA_EXTRACTION

You are an expert in extracting bibliographic metadata using Schema.org in compact JSON-LD format.

You are given a PDF document that contains the first {n} and last {n} pages of a book.
""" 

DEFINE_META_PROMPT_NON_PDF_HEADER = """
# TASK: METADATA EXTRACTION FROM PARTIAL TEXT

You are an expert in extracting bibliographic metadata using Schema.org in compact JSON-LD format.

You are given the **first {n} characters** of the extracted text from a book or document in Markdown format. This may include the title page, legal page, preface, table of contents, or other early parts of the book.
""" 

DEFINE_META_PROMPT_BODY="""
## üîí Rules
- Only use verifiable information present in the input text.
- If any field is missing or uncertain, do not guess ‚Äî leave it out.
- Do not invent metadata like author or publication date if not found in the input.
- Use UTF-8 characters.
- Dehyphenate words broken across lines in the extracted output.
- Omit any property that is not found ‚Äî do not include nulls, placeholders, or default values.
- **If multiple values** are present (e.g. several ISBNs or authors), include all explicitly present ones as arrays.

## üìò Metadata Format
Use the `Book` schema where appropriate, but apply a more specific `@type` if a different one fits better. Here are the allowed types and examples:

### `@type` Reference:
| Type                      | `@type`               | Examples                                                   |
|---------------------------|------------------------|------------------------------------------------------------|
| Fiction / novel           | `Book`                 | Stories, fairy tales                                       |
| Poetry collection         | `CreativeWork`         | Anthologies of poems                                       |
| Religious text            | `Book` or `CreativeWork` | Quran, Bible, religious treatises                        |
| School / university textbook | `Book`              | Educational materials                                      |
| Bilingual dictionary      | `CreativeWork`         | Russian-Tatar dictionary                                   |
| Encyclopedia article      | `Article` or `CreativeWork` | Encyclopedia entries                                    |
| Legal code or law         | `Legislation`          | Laws, codes, constitutions                                 |
| Governmental decree       | `Legislation`          | Orders, hiring decisions, local policies                   |
| Court ruling              | `Legislation`          | –°—É–¥–µ–±–Ω–æ–µ –ø–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ                                     |
| Report / audit            | `Report`               | Government or organizational reports                       |
| Scholarly paper           | `ScholarlyArticle`     | Academic research articles                                 |
| Thesis / dissertation     | `Thesis`               | Master's or PhD theses                                     |
| Newspaper article         | `NewsArticle`          | Daily press                                                |
| Magazine article          | `Article`              | Journalism and interviews                                  |
| User manual / how-to      | `HowTo` or `Book`      | Instructions or practical guides                           |
| Memoir or autobiography   | `Book`                 | Personal recollections         

## üìë Required Fields (if available):
- `@context`: `"https://schema.org"`
- `@type`: Choose the correct type as listed above
- `name`: Title of the work
- `author`: Name(s) of author(s) or organization (use `"@type": "Person"` or `"@type": "Organization"`)
- `contributor`: Persons involved in roles such as: author, editor, translator, illustrator, composer, lyricist, contributor, reviewer, publisher, sponsor. Express roles in English
- `inLanguage`: Use BCP 47 with script: e.g., `"tt-Cyrl"`, `"tt-Latn-x-zamanalif"`, `"ru-Cyrl"` as listed above
- `datePublished`: Use full date format if found: `"YYYY-MM-DD"`
- `publisher`: `"@type": "Organization"` if identified
- `isbn`: array of ISBN numbers if available
- `numberOfPages`: If identified
- `additionalProperty`: Use this to include UDC, BBK, or other classification codes
- `genre`: Book genre, expressed in English
- `audience`: Target audience, expressed in English
- `bookEdition`: Edition information
- `description`: Preface, abstract, or annotation in Tatar language. Use 1‚Äì3 sentences only. Summarize the core purpose or content of the text. Do not include long quotations or excessive legal/formal language. Avoid repeating the title.

## Input language
Text may appear in different scripts. Automatically detect the **primary language and script** used in the document, and return the correct `inLanguage` BCP 47 tag.
- Tatar in Cyrillic script ‚Üí use `"tt-Cyrl"`
- Tatar in Zamanalif Latin script ‚Üí use `"tt-Latn-x-zamanalif"`
- Tatar in Yanalif Latin script ‚Üí use `"tt-Latn-x-yanalif"`
- Tatar in Arabic script ‚Üí use `"tt-Arab"`
- Russian in Cyrillic script ‚Üí use `"ru-Cyrl"`

### Markdown formatted Examples of input:
- Tatar Cyrillic(tt-Cyrl): # –¢–ê–¢–ê–†–°–¢–ê–ù –†–ï–°–ü–£–ë–õ–ò–ö–ê–°–´ –ö–û–ù–°–¢–ò–¢–£–¶–ò–Ø–°–ï\n(2002 –µ–ª–Ω—ã“£ 19 –∞–ø—Ä–µ–ª–µ–Ω–¥”ô–≥–µ 1380 –Ω–æ–º–µ—Ä–ª—ã, 2003 –µ–ª–Ω—ã“£ 15 —Å–µ–Ω—Ç—è–±—Ä–µ–Ω–¥”ô–≥–µ 34-–¢–†–ó –Ω–æ–º–µ—Ä–ª—ã, 2004 –µ–ª–Ω—ã“£ 12 –º–∞—Ä—Ç—ã–Ω–¥–∞–≥—ã 10-–¢–†–ó –Ω–æ–º–µ—Ä–ª—ã, 2005 –µ–ª–Ω—ã“£ 14 –º–∞—Ä—Ç—ã–Ω–¥–∞–≥—ã 55-–¢–†–ó –Ω–æ–º–µ—Ä–ª—ã, 2010 –µ–ª–Ω—ã“£ 30 –º–∞—Ä—Ç—ã–Ω–¥–∞–≥—ã 10-–¢–†–ó –Ω–æ–º–µ—Ä–ª—ã, 2010 –µ–ª–Ω—ã“£ 22 –Ω–æ—è–±—Ä–µ–Ω–¥”ô–≥–µ 79-–¢–†–ó –Ω–æ–º–µ—Ä–ª—ã, 2012 –µ–ª–Ω—ã“£ 22 –∏—é–Ω–µ–Ω–¥”ô–≥–µ 40-–¢–†–ó –Ω–æ–º–µ—Ä–ª—ã –¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω –†–µ—Å–ø—É–±–ª–∏–∫–∞—Å—ã –∑–∞–∫–æ–Ω–Ω–∞—Ä—ã —Ä–µ–¥–∞–∫—Ü–∏—è—Å–µ–Ω–¥”ô)\n\n”ò–ª–µ–≥–µ –ö–æ–Ω—Å—Ç–∏—Ç—É—Ü–∏—è, –¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω –†–µ—Å–ø—É–±–ª–∏–∫–∞—Å—ã–Ω—ã“£ –∫“Ø–ø–º–∏–ª–ª”ô—Ç–ª–µ —Ö–∞–ª–∫—ã “ª”ô–º —Ç–∞—Ç–∞—Ä —Ö–∞–ª–∫—ã –∏—Ö—Ç—ã—è—Ä—ã–Ω —á–∞–≥—ã–ª–¥—ã—Ä—ã–ø, \n–∫–µ—à–µ “ª”ô–º –≥—Ä–∞–∂–¥–∞–Ω —Ö–æ–∫—É–∫–ª–∞—Ä—ã–Ω—ã“£ “ª”ô–º –∏—Ä–µ–∫–ª”ô—Ä–µ–Ω–µ“£ ”©—Å—Ç–µ–Ω–ª–µ–≥–µ–Ω –≥–∞–º”ô–ª–≥”ô –∞—à—ã—Ä–∞, —Ö–∞–ª—ã–∫–ª–∞—Ä–Ω—ã“£ –≥–æ–º—É–º—Ç–∞–Ω—ã–ª–≥–∞–Ω “Ø–∑–±–∏–ª–≥–µ–ª”ô–Ω“Ø —Ö–æ–∫—É–∫—ã–Ω–∞, –∞–ª–∞—Ä–Ω—ã“£ —Ç–∏–≥–µ–∑ —Ö–æ–∫—É–∫–ª—ã–ª—ã–≥—ã, –∏—Ö—Ç—ã—è—Ä –±–µ–ª–¥–µ—Ä“Ø–Ω–µ“£ –∏—Ä–µ–∫–ª–µ–ª–µ–≥–µ “ª”ô–º –±”ô–π—Å–µ–∑–ª–µ–≥–µ –ø—Ä–∏–Ω—Ü–∏–ø–ª–∞—Ä—ã–Ω–∞ –Ω–∏–≥–µ–∑–ª”ô–Ω”ô,\n—Ç–∞—Ä–∏—Ö–∏, –º–∏–ª–ª–∏ “ª”ô–º —Ä—É—Ö–∏ —Ç—Ä–∞–¥–∏—Ü–∏—è–ª”ô—Ä–Ω–µ“£, –º”ô–¥”ô–Ω–∏—è—Ç–ª”ô—Ä–Ω–µ“£, —Ç–µ–ª–ª”ô—Ä–Ω–µ“£ —Å–∞–∫–ª–∞–Ω—ã–ø –∫–∞–ª—É—ã–Ω–∞ “ª”ô–º “Ø—Å–µ—à–µ–Ω”ô, –≥—Ä–∞–∂–¥–∞–Ω–Ω–∞—Ä —Ç–∞—Ç—É–ª—ã–≥—ã–Ω “ª”ô–º –º–∏–ª–ª”ô—Ç–∞—Ä–∞ –∫–∏–ª–µ—à“Ø–Ω–µ —Ç”ô—ç–º–∏–Ω –∏—Ç“Ø–≥”ô —è—Ä–¥”ô–º –∏—Ç”ô, \n—Ñ–µ–¥–µ—Ä–∞–ª–∏–∑–º –ø—Ä–∏–Ω—Ü–∏–ø–ª–∞—Ä—ã–Ω–¥–∞ –¥–µ–º–æ–∫—Ä–∞—Ç–∏—è–Ω–µ“£ –Ω—ã–≥—É—ã, –¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω –†–µ—Å–ø—É–±–ª–∏–∫–∞—Å—ã–Ω—ã“£ —Å–æ—Ü–∏–∞–ª—å-–∏–∫—ä—Ç–∏—Å–∞–¥—ã–π “Ø—Å–µ—à–µ, –†–æ—Å—Å–∏—è –§–µ–¥–µ—Ä–∞—Ü–∏—è—Å–µ —Ö–∞–ª—ã–∫–ª–∞—Ä—ã–Ω—ã“£ —Ç–∞—Ä–∏—Ö–∏ –±–∞—Ä–ª—ã–∫–∫–∞ –∫–∏–ª–≥”ô–Ω –±–µ—Ä–¥”ô–º–ª–µ–≥–µ–Ω —Å–∞–∫–ª–∞–ø –∫–∞–ª—É ”©—á–µ–Ω —à–∞—Ä—Ç–ª–∞—Ä —Ç—É–¥—ã—Ä–∞.\n\n## I –ö–ò–°”ò–ö. –ö–û–ù–°–¢–ò–¢–£–¶–ò–Ø–ß–ï–õ –ö–û–†–´–õ–´–® –ù–ò–ì–ï–ó–õ”ò–†–ï\n### 1 —Å—Ç–∞—Ç—å—è\n1. –¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω –†–µ—Å–ø—É–±–ª–∏–∫–∞—Å—ã ‚Äì –†–æ—Å—Å–∏—è –§–µ–¥–µ—Ä–∞—Ü–∏—è—Å–µ –ö–æ–Ω—Å—Ç–∏—Ç—É—Ü–∏—è—Å–µ, –¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω –†–µ—Å–ø—É–±–ª–∏–∫–∞—Å—ã –ö–æ–Ω—Å—Ç–∏—Ç—É—Ü–∏—è—Å–µ “ª”ô–º ¬´–†–æ—Å—Å–∏—è –§–µ–¥–µ—Ä–∞—Ü–∏—è—Å–µ –¥”ô“Ø–ª”ô—Ç —Ö–∞–∫–∏–º–∏—è—Ç–µ –æ—Ä–≥–∞–Ω–Ω–∞—Ä—ã “ª”ô–º –¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω –†–µ—Å–ø—É–±–ª–∏–∫–∞—Å—ã –¥”ô“Ø–ª”ô—Ç —Ö–∞–∫–∏–º–∏—è—Ç–µ –æ—Ä–≥–∞–Ω–Ω–∞—Ä—ã –∞—Ä–∞—Å—ã–Ω–¥–∞ —ç—à–ª”ô—Ä –±“Ø–ª–µ—à“Ø “ª”ô–º “Ø–∑–∞—Ä–∞ –≤”ô–∫–∞–ª”ô—Ç–ª”ô—Ä –∞–ª–º–∞—à—É —Ç—É—Ä—ã–Ω–¥–∞¬ª –†–æ—Å—Å–∏—è –§–µ–¥–µ—Ä–∞—Ü–∏—è—Å–µ “ª”ô–º –¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω –†–µ—Å–ø—É–±–ª–∏–∫–∞—Å—ã –®–∞—Ä—Ç–Ω–∞–º”ô—Å–µ –Ω–∏–≥–µ–∑–µ–Ω–¥”ô –†–æ—Å—Å–∏—è –§–µ–¥–µ—Ä–∞—Ü–∏—è—Å–µ –±–µ–ª”ô–Ω –±–µ—Ä–ª”ô—à–∫”ô–Ω “ª”ô–º –†–æ—Å—Å–∏—è –§–µ–¥–µ—Ä–∞—Ü–∏—è—Å–µ —Å—É–±—ä–µ–∫—Ç—ã –±—É–ª–≥–∞–Ω –¥–µ–º–æ–∫—Ä–∞—Ç–∏–∫ —Ö–æ–∫—É–∫—ã–π –¥”ô“Ø–ª”ô—Ç. –¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω –†–µ—Å–ø—É–±–ª–∏–∫–∞—Å—ã —Å—É–≤–µ—Ä–µ–Ω–∏—Ç–µ—Ç—ã, –†–æ—Å—Å–∏—è –§–µ–¥–µ—Ä–∞—Ü–∏—è—Å–µ –∫–∞—Ä–∞–º–∞–≥—ã–Ω–¥–∞–≥—ã –º”ô—Å—å”ô–ª”ô–ª”ô—Ä–¥”ô–Ω “ª”ô–º –†–æ—Å—Å–∏—è –§–µ–¥–µ—Ä–∞—Ü–∏—è—Å–µ “ª”ô–º –¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω –†–µ—Å–ø—É–±–ª–∏–∫–∞—Å—ã–Ω—ã“£ —É—Ä—Ç–∞–∫ –∫–∞—Ä–∞–º–∞–≥—ã–Ω–¥–∞–≥—ã –º”ô—Å—å”ô–ª”ô–ª”ô—Ä –±—É–µ–Ω—á–∞ –†–æ—Å—Å–∏—è –§–µ–¥–µ—Ä–∞—Ü–∏—è—Å–µ –≤”ô–∫–∞–ª”ô—Ç–ª”ô—Ä–µ–Ω–Ω”ô–Ω —Ç—ã—à, –¥”ô“Ø–ª”ô—Ç —Ö–∞–∫–∏–º–∏—è—Ç–µ–Ω–µ“£ (–∑–∞–∫–æ–Ω —á—ã–≥–∞—Ä—É, –±–∞—à–∫–∞—Ä–º–∞ “ª”ô–º —Å—É–¥) –±”©—Ç–µ–Ω —Ç—É–ª—ã–ª—ã–≥—ã–Ω–∞ –∏—è –±—É–ª—É–¥–∞ —á–∞–≥—ã–ª–∞ “ª”ô–º –¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω –†–µ—Å–ø—É–±–ª–∏–∫–∞—Å—ã–Ω—ã“£ –∞–µ—Ä—ã–ª–≥—ã—Å—ã–∑ —Ö–∞—Å–∏—è—Ç–µ –±—É–ª–∞.\n\n2. –¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω –†–µ—Å–ø—É–±–ª–∏–∫–∞—Å—ã “ª”ô–º –¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω –∏—Å–µ–º–Ω”ô—Ä–µ –±–µ—Ä “Ø–∫ –º”ô–≥—ä–Ω”ô–≥”ô –∏—è.\n\n3. –¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω –†–µ—Å–ø—É–±–ª–∏–∫–∞—Å—ã —Å—Ç–∞—Ç—É—Å—ã –¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω –†–µ—Å–ø—É–±–ª–∏–∫–∞—Å—ã–Ω—ã“£ “ª”ô–º –†–æ—Å—Å–∏—è –§–µ–¥–µ—Ä–∞—Ü–∏—è—Å–µ–Ω–µ“£ “Ø–∑–∞—Ä–∞ —Ä–∏–∑–∞–ª—ã–≥—ã–Ω–Ω–∞–Ω –±–∞—à–∫–∞ “Ø–∑–≥”ô—Ä—Ç–µ–ª”ô –∞–ª–º—ã–π. –¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω –†–µ—Å–ø—É–±–ª–∏–∫–∞—Å—ã —á–∏–∫–ª”ô—Ä–µ –∞–Ω—ã“£ —Ä–∏–∑–∞–ª—ã–≥—ã–Ω–Ω–∞–Ω –±–∞—à–∫–∞ “Ø–∑–≥”ô—Ä—Ç–µ–ª”ô –∞–ª–º—ã–π. 
- Tatar Latin(Zamanalif - tt-Latn-x-zamanalif): Tatarstan Respublikasƒ± Ministrlar Kabinetƒ± √ºz ormativ-xoquqƒ±y aktlarƒ±n √§lege Zakonƒüa yaraqla≈ütƒ±rƒ±rƒüa tie≈ü.\n\nTatarstan Respublikasƒ± Prezidentƒ± **M. ≈û√§ymiev**.\n\nQazan ≈ü√§h√§re, 1999 yƒ±l, 15 sent√§br. ‚Ññ2352.\n\n## Alfavit h√§m orfografi√§\nOrfografi√§ ‚Äî d√∂res yazu qaƒüid√§l√§re dig√§n s√ºz. Ul bilgele ber alfavitqa nigezl√§n√§. Bu orfografi√§ Tatarstan Respublikasƒ± Prezidentƒ± tarafƒ±nnan 1999 yƒ±lnƒ±√± 15 sent√§brend√§ qul quyƒ±lƒüan Zakonda qabul itelg√§n alfavitqa nigezl√§nep t√∂zelde.\n\nYa√±a alfavit 34 x√§reft√§n tora, anda suzƒ±q awazlarnƒ± belder√º√ße ‚Äî 9, tartƒ±qlarnƒ± belder√º√ße ‚Äî 25 x√§ref k√ºrs√§telg√§n. Apostrof, sir√§k qullanƒ±lƒüanlƒ±qtan, alfavitta ayƒ±rƒ±m urƒ±n almaƒüan, ul, h√§mz√§ne (t√§‚Äômin) belder√º√ße h√§m ne√ßk√§lek bilgese bularaq, barƒ± orfografi√§d√§ gen√§ is√§pk√§ alƒ±na.\n\nBu zakondaƒüƒ± alfavit, nigezd√§, 1927‚Äî1939 yƒ±llarda qullanƒ±lƒüan ‚ÄúYa√±alif‚Äù alfavitƒ±n ya√±adan torƒüƒ±zuƒüa qaytƒ±p qala. L√§kin bired√§ ‚ÄúYa√±alif‚Äùne tulƒ±sƒ±n√ßa ≈üul kile≈ü kire qaytaru yuq, h√§m ul bula da almƒ±y, √ß√∂nki anƒ±√± qullanƒ±lmawƒ±na 60 yƒ±l √ºtte, tormƒ±≈ü √ºzg√§rde: yazularƒ± latin grafikasƒ±na nigezl√§ng√§n K√∂nbatƒ±≈ü tell√§ren √∂yr√§n√º massak√ºl√§m k√ºrene≈ük√§ √§yl√§nde, xalƒ±qara urtaq kompyuterlar bel√§n e≈ü it√º, x√§tta d√∂nyak√ºl√§m informatsi√§ sistemasƒ±na ‚Äî internetqa √ßƒ±ƒüu ƒü√§d√§tk√§ kerde, t√∂rki xalƒ±qlarnƒ±√± √ºzara arala≈üa, ber-bersen ruxi bayƒ±ta alu m√∂mkinlekl√§re a√ßƒ±ldƒ±.\n\nMen√§ ≈üul ≈üartlarda ‚ÄúYa√±alif‚Äù √ºzg√§rtelmi√ß√§ torƒüƒ±zƒ±lƒüan bulsa, tatar balasƒ±, tatar h√§m √ßit il latinitsalarƒ± arasƒ±ndaƒüƒ± ayƒ±rmalarnƒ± k√ºbr√§k k√ºrep, qƒ±yƒ±n x√§ld√§ yƒ±≈üraq qalƒ±r ide, tatar ke≈üese, kompyuter qullanƒüanda, bigr√§k t√§ anƒ±√± y√§rd√§mend√§ internetqa √ßƒ±ƒüƒ±p e≈ül√§g√§nd√§, qƒ±yƒ±nlƒ±qlarnƒ± k√ºbr√§k k√ºrer ide, t√∂rki tuƒüannarƒ±nƒ±√± yazularƒ±n uqƒ±rƒüa turƒ± kils√§ d√§, t√∂rle √ßitenlekl√§rg√§ du√ßar bulƒ±r ide.\n\n≈ûu≈üƒ± √§ytelg√§nn√§rne ist√§ totƒ±p, TR D√§wl√§t Sovetƒ± Zakonƒüa ‚ÄúYa√±alif‚Äùne beraz √ºzg√§rtep t√∂zelg√§n ya√±a alfavitnƒ± t√§qdim itte, h√§m ul, bilgele, kim√ßelekl√§re bulsa da, x√§zerge zaman tal√§pl√§ren√§ nƒ±ƒüraq cawap bir√§.\n\n## Tatar orfografi√§sen t√∂z√º prinsiplarƒ±\nH√§rber telne√± orfografi√§se t√∂rle prinsiplarƒüa nigezl√§nep t√∂zel√§. Tatar orfografi√§se t√ºb√§nd√§ge prinsiplarƒüa nigezl√§ng√§n.\n\n**Fonetik prinsip** ‚Äî i≈üetelg√§n√ß√§ yazu dig√§n s√ºz. Tatarnƒ±√± t√∂p s√ºzl√§re h√§m tatar√ßa √§ytele≈ük√§ buysƒ±nƒüan y√§ki turƒ± kilg√§n alƒ±nmalar i≈üetelg√§n√ß√§, y√§ƒüni fonetik prinsipqa nigezl√§nep yazƒ±lalar: √§ni, ulƒ±m, √∂yd√§gel√§r, k√ºr≈üe awƒ±llarda, b√ºr√§n√§, s√§l√§m, kitap, namaz, magazin h.b.\n\n**Grafik prinsip** ‚Äî alƒ±nma s√ºzl√§rne bir√º√ße teld√§geg√§ ox≈üatƒ±p yazu dig√§n s√ºz. Tatar√ßa √§ytele≈ük√§ buysƒ±nƒ±p citm√§g√§n alƒ±nma s√ºzl√§r, grafik prinsipqa nigezl√§nep, birg√§n teld√§ge yazƒ±lƒ±≈üqa ox≈üatƒ±p yazƒ±lalar: tarixi (tarixƒ±y t√ºgel), Talip (Talƒ±yp t√ºgel); morfologi√§ (marfologi√§ t√ºgel), motor (mator t√ºgel), traktor (traktƒ±r t√ºgel) h.b.\n\n***ƒ∞sk√§rm√§.*** Tarixi, Talip kebek s√ºzl√§rd√§ i yazu (ƒ±y yazmaw) misalƒ±nda bez ekonomi√§ prinsibƒ±n da k√ºz√§t√§bez [Ekonomi√§ prinsibƒ±nƒ±√± 3-n√ße punktƒ±n qaraƒüƒ±z].\n\n**Morfologik prinsip** ‚Äî s√∂yl√§md√§ √ºzg√§re≈ük√§ o√ßraƒüan morfemanƒ± yazuda √ºzg√§re≈üsez qaldƒ±ru: [umber, umbi≈ü] dig√§nd√§ un morfemasƒ± [b] awazƒ± t√§‚Äôsirend√§ √ºzg√§r√§, l√§kin ul √ºzg√§re≈ü yazuda k√ºrs√§telmi, un morfemasƒ± saqlana: un ber, un bi≈ü, yaz ‚Äî yazsa (yassa t√ºgel), s√ºz√ß√§n (s√ºs√ß√§n t√ºgel), rus√ßa (ru√ß√ßa t√ºgel), irt√§nge (irt√§√±ge t√ºgel), is√§nme (is√§mme t√ºgel) h.b.\n\n**Ekonomiy√§ prinsibƒ±** ‚Äî yazu protsessƒ±nda waqƒ±tqa h√§m urƒ±nƒüa ekonomi√§ yasaw √∂√ßen, s√ºzl√§rne qƒ±sqartƒ±p yazu dig√§n s√ºz. Bu prinsip ≈üaqtƒ±y k√ºp k√ºz√§tel√§.\n\n1. Teld√§ yƒ±≈ü qullanƒ±la h√§m k√ºpl√§rg√§ tanƒ±≈ü qu≈üma atamalar andaƒüƒ± s√ºzl√§rne√± ba≈ü x√§refl√§ren gen√§ yazu yulƒ± bel√§n qƒ±sqartƒ±lalar: Berl√§≈ük√§n mill√§tl√§r oyƒ±≈ümasƒ± ‚Äî BMO; Tatarstan Respublikasƒ± Ministrlar Kabinetƒ± ‚Äî TR MK; Tatarstan F√§nn√§r akademi√§se ‚Äî TFA; Tel, √§d√§biyat h√§m s√§nƒü√§t institutƒ± ‚Äî T√ÑhSƒ∞.\n\nYƒ±≈ü o√ßrƒ±y torƒüan ike s√ºz qƒ±sqartƒ±lƒüanda, ul s√ºzl√§rne√± beren√ße (yul) x√§refl√§re gen√§ noqta quyƒ±lƒ±p yazƒ±la: h√§m ba≈üqalar ‚Äî h.b.; h√§m ba≈üqa ≈üundƒ±ylar ‚Äî h.b.≈ü.\n\nK√ºpl√§rg√§ tanƒ±≈ü bulmaƒüan atamalarnƒ± qƒ±sqartƒ±p yazarƒüa kir√§k bulƒüanda, ayƒ±rƒ±m tekstlarda ul atama ba≈üta tulƒ±sƒ±n√ßa yazƒ±la, ≈üunda uq c√§y√§l√§r e√ßend√§ anƒ±√± qƒ±sqartƒ±lmasƒ± birel√§, ul tekstta annan so√± barƒ± qƒ±sqartƒ±lma s√ºz gen√§ yazƒ±la, m√§s√§l√§n, Min bu m√§q√§l√§md√§ Tatarstan Respublikasƒ±nƒ±√± Ekologi√§ institutƒ± (TR Eƒ∞) turƒ±nda s√∂yl√§rg√§ cƒ±yƒ±nam,‚Äî dip k√ºrs√§tk√§nn√§n so√±, avtor bu s√ºzl√§r tezm√§sen ya√±adan tulƒ±sƒ±n√ßa yazmƒ±y, anƒ± barƒ± TR Eƒ∞ dip ken√§ qƒ±sqartƒ±p bir√§.\n\n2. Qu≈üma atamalardaƒüƒ± y√§ ber s√ºzne√±, y√§ barlƒ±q s√ºzl√§rne√± d√§ y√§ ike x√§refe, y√§ ber icege yazƒ±la: KamAZ, AlAZ, YuXƒ∞Dƒ∞, KamGes, univermag h.b. Qu≈üma s√ºzne√± so√±ƒüƒ±sƒ± tulƒ± kile≈ü, ba≈ütaƒüƒ±larƒ± qƒ±sqartƒ±lƒ±p yazƒ±lƒ±rƒüa da m√∂mkin: dramt√ºg√§r√§k, Tatpotrebsoyuz, Kazjilstroy h.b.\n\n3. Ekonomi√§ prinsibƒ± yarƒ±m√§ytele≈üle awazlarnƒ± yazuda k√ºrs√§tm√§wd√§ d√§ √ßaƒüƒ±la, m√§s√§l√§n, su s√ºzend√§ ike awaz arasƒ±nda ƒ± i≈üetelg√§n kebek bula, l√§kin ul yazuda k√ºrs√§telmi (sƒ±u dip yazƒ±lmƒ±y); uqƒ±, tuqƒ± s√ºzl√§ren√§ [u] awazƒ± qu≈üƒ±lƒüa√ß, [u] aldƒ±nnan [ƒ±] i≈üetelg√§n kebek bula, l√§kin ul yazuda k√ºrs√§telmi, uqƒ±u dip yazƒ±lmƒ±y, uqu dip yazƒ±la; baru, kil√º kebek fiƒüell√§rd√§, tartƒ±m qu≈üƒ±m√ßasƒ± aldƒ±nnan [w] i≈üetelƒü√§n kebek bula [baruwƒ±, kil√ºwe], l√§kin ul yazuda √ßaƒüƒ±lmƒ±y, baruƒ±, kil√ºe r√§we≈üend√§ gen√§ yazƒ±la; i√§, i√§k, orfografi√§ kebek s√ºzl√§rd√§, [i] h√§m [√§] awazlarƒ± arasƒ±nda [y] i≈üetelg√§n kebek bulsa da, anƒ±, ekonomi√§ prinsibƒ±nnan √ßƒ±ƒüƒ±p, yazuda k√ºrs√§tmil√§r. (Taƒüƒ±n 31-n√ße ¬ßnƒ±√± 2-n√ße isk√§rm√§sen h√§m 33-n√ße ¬ßnƒ±√± 2-n√ße isk√§rm√§sen qaraƒüiz).\n\n**Tarixi prinsip** ‚Äî ba≈üqa√ßaraq i≈üetels√§ d√§, s√ºzl√§rne elekke √ßordaƒüƒ±√ßa yazu dig√§n s√ºz. Bu prinsip iske yazulƒ± tell√§rd√§ (m√§s., ingliz telend√§) yƒ±≈ü k√ºz√§tel√§, tatar telend√§ yuq d√§r√§c√§send√§ az. [o], [√∂] awazlarƒ± beren√ße icekt√§ gen√§ t√ºgel, iken√ße, √∂√ßen√ßel√§rend√§ √§ytels√§ d√§, alarnƒ± barƒ± beren√ße icekt√§ gen√§ yazarƒüa dig√§n qaƒüid√§ elekt√§n ‚ÄúYa√±alif‚Äù orfografi√§senn√§n k√º√ßerelde, dim√§k, anƒ±√± yazƒ±lƒ±≈üƒ±, bilgele d√§r√§c√§d√§, tarixi prinsipqa nigezl√§ng√§n.\n\n## D√∂res yazu qaƒüid√§l√§re\n\n### Suzƒ±q awaz x√§refl√§rene√± yazƒ±lƒ±≈üƒ±\n\n¬ß 1. A x√§refe [a] awazƒ± √§ytelg√§n h√§r urƒ±nda yazƒ±la: aƒüa√ß, qara, kamzul, garmun h.b. 
- Tatar Latin(Yanalif - tt-Latn-x-yanalif): Quz∆£al, ujan, l…ô∆£n…ôt itelg…ôn\nQollar h…ôm aclar d…µnjas—å,\nDo≈ümannan yc als—ån tygelg…ôn\nYksezl…ôr, tollar kyz j…ô≈üe\nQanl—å su∆£—å≈üqa  ôez √ß—å∆£ar ô—åz,\n√áimerer ôez iske d…µnjan—å!\nAn—åÍûë ur—ån—åna  ôez qor—år ô—åz,\nT—åzer ôez matur, jaÍûëan—å!\n\nBu  ôul—år iÍûë ax—år∆£—å, iÍûë qat—å zur √ßihat,\nBul—år h…ôm  ô…ôjlnlmil…ôr  ô…ôni insan azat!\n\nBezne hic kem azat it…ô almas,\nIts…ôk ‚Äî it…ôr ôez yze ôez,\nBezne hic kem ≈üat it…ô almas,\nIts…ôk ‚Äî it…ôr ôez yze ôez,\n∆èjdn…ô zalimn…ôrg…ô  ôez qar≈ü—å\n∆¢…ôjr…ôt  ôel…ôn su∆£—å≈ü—åp  ôar—åjq,\nTus—ån  ôalq—åp irek qoja≈ü—å,\nXoquqlar—å ô—ån—å al—åjq!\n\nBu  ôul—år iÍûë ax—år∆£—å, iÍûë qat—å zur √ßihat,\nBul—år h…ôm  ô…ôjlnlmil…ôr  ô…ôni insan azat!\n\nBez  ôar √ßihan e≈ücel…ôre ôez,\nBez  ôar d…µnjan—åÍûë ∆£…ôsk…ôr,\n√áirl…ôr  ôezneÍûë yz √ßirl…ôre ôez,\nBeznƒôder  ôar d…ôyl…ôtl…ôre!\nC—å∆£—åjq  ôez m…ôjdan—åna  ôez,\nDo≈ümannar xur  ôel…ôn qacar,\nC—å∆£a ô—åz h…ôm inana ô—åz\nQoja≈ü  ôezg…ô nur—ån c…ôc…ôr!\n\nBu  ôul—år iÍûë ax—år∆£—å, iÍûë qat—å zur √ßihat,\nBul—år h…ôm  ô…ôjlnlmil…ôr  ô…ôni insan azat! Barlƒ±q ke≈üel…ôr d…ô azat h…ôm √ºz abruylarƒ± h…ôm xoquqlarƒ± yaƒüƒ±nnan tiÍûë bulƒ±p tualar. Alarƒüa aqƒ±l h…ôm w…µcdan birelg…ôn h…ôm ber-bersen…ô qarata tuƒüannar√ßa m…µnas…ôb…ôtt…ô bulƒ±rƒüa tie≈ül…ôr.  
- Tatar Arabic(tt-Arab): ⁄©ÿ™ÿßÿ®\nÿåŸá€å⁄ÜÿØŸá ⁄©Ÿà⁄≠ŸÑŸÖ ÿ¢⁄ÜŸÑŸÖÿßÿ≥ŸÑŸÇ ÿß⁄ÜŸÖ ŸæŸàÿ¥ÿ≥Ÿá\nÿåÿßŸàÿ≤ ÿßŸàÿ≤ŸÖŸÜ€å ⁄©Ÿàÿ±Ÿá‚ÄåŸÑŸÖ€å⁄ÜŸá ÿ±Ÿàÿ≠ŸÖ ÿ™Ÿàÿ¥ÿ≥Ÿá\nÿ¨ŸÅÿß ⁄Ü€å⁄©ÿ≥Ÿá‚ÄåŸÖÿå ÿ¨ŸàÿØŸá‚Äåÿ® ÿ®ÿ™ÿ≥Ÿá‚ÄåŸÖ ÿ®Ÿà ÿ®ÿßÿ¥ŸÖŸÜ€å\nÿåŸÇŸà€åÿßŸÑŸÖ€å⁄ÜŸá ÿ¨ÿßŸÜÿ∫Ÿá ÿ¨ŸÑ€å Ÿá€å⁄Ü ÿ®ÿ± ÿ™Ÿàÿ¥⁄©Ÿá\nÿåÿ≠ÿ≥ÿ±ÿ™ ÿµŸà⁄≠ÿ±Ÿá ÿ≠ÿ≥ÿ±ÿ™ ⁄©€åŸÑÿ® ÿ¢ŸÑŸÖÿßÿ¥ÿå ÿ¢ŸÑŸÖÿßÿ¥\nÿå⁄©Ÿà⁄≠ŸÑÿ≥ÿ≤ ÿßŸà€å ÿ®ŸÑŸá‚ÄåŸÜ ÿ™ŸÖÿßŸÖ ÿ¶Ÿá‚Äå€åŸÑŸá‚ÄåŸÜÿ≥Ÿá ÿ®ÿßÿ¥\n⁄©Ÿàÿ≤ŸÑÿ±ŸÖÿØŸá ⁄©€åÿ®ÿ®ÿØŸá ÿ¨€åÿ™ŸÖ⁄ØÿßŸÜ ÿ®ŸàŸÑÿ≥Ÿá\n.ÿ≠ÿßÿ∂ÿ±⁄ØŸÜŸá ÿµÿ∫ŸÑŸàÿ®ÿå ÿµÿ∫ŸÑŸàÿ® ÿ¨ŸÑÿßÿ∫ÿßŸÜ €åÿßÿ¥\nÿ¥ŸàŸÑ ŸàŸÇÿ™ÿØŸá ŸÖ€åŸÜ ŸÇŸàŸÑ€åŸÖŸá ⁄©ÿ™ÿßÿ® ÿ¢ŸÑÿßŸÖ\nÿ¢ŸÜ⁄≠ ÿß€åÿ≤⁄Ø€å ÿµÿ≠€åŸÅŸá‚ÄåŸÑÿ±ŸÜ ÿ¢ŸÇÿ™ÿßÿ±ÿßŸÖ\n.ÿ±ÿßÿ≠ÿ™ŸÑŸá‚ÄåŸÜŸàÿ® ⁄©€åÿ™Ÿá ÿ¥ŸàŸÜÿØŸá ÿ¨ÿßŸÜŸÖÿå ÿ™Ÿá‚ÄåŸÜŸÖ\n.ÿ¥ŸàŸÜÿØŸÜÿ∫ŸÜŸá ÿØÿ±ÿØŸÑÿ±ŸäŸÖŸá ÿØÿ±ŸÖÿßŸÜ ÿ∑ÿßÿ®ÿßŸÖ\nÿåÿßŸàŸÇŸàÿ® ÿ®ÿßÿ±ÿ∫ÿßŸÜ Ÿáÿ±ÿ®ÿ± €åŸàŸÑŸÖÿå Ÿáÿ±ÿ®ÿ± ÿ≥Ÿàÿ≤ŸÖ\nÿ®ŸàŸÑÿß ŸÖ€åŸÜŸÖ €åŸàŸÑ ⁄©Ÿàÿ±ÿ≥Ÿá‚Äåÿ™⁄©Ÿà⁄Ü€å €åŸàŸÑÿØÿ≤ŸÖ\nÿ≥Ÿà€åŸÖ€å ÿ®ÿßÿ¥ŸÑ€åŸÖ ÿ®Ÿà ÿØŸÜ€åÿßŸÜ⁄≠ ŸàÿßŸÇŸÑŸÇŸÑÿ±ŸÜ\n.ÿ¢⁄Ü€åŸÑÿß‚ÄåÿØÿ±ÿå ŸÜŸàÿ±ŸÑÿßŸÜÿß‚ÄåÿØÿ± ⁄©Ÿà⁄≠ŸÑŸÖÿå ⁄©Ÿàÿ≤ŸÖ\nÿ¨€å⁄≠ŸÑŸÑŸá‚ÄåŸÜŸá‚ÄåŸÖÿå ŸÖÿπÿµŸàŸÖŸÑŸá‚ÄåŸÜŸá‚ÄåŸÖ ŸÖ€åŸÜ ÿ¥ŸàŸÑ ⁄ÜÿßŸÇÿØŸá\nÿ±ÿ≠ŸÖÿ™ ÿ¶Ÿá‚Äå€åÿ™Ÿá‚ÄåŸÖ ÿßŸàŸÇŸàÿ∫ÿßŸÜŸÖ ÿ¥ŸàŸÑ ⁄©ÿ™ÿßÿ®ŸÇŸá\nÿåÿßÿ¥ÿßŸÜ⁄ÜŸÖ ÿ¢ÿ±ÿ∑Ÿá‚Äå ŸÖ€åŸÜŸÖ ÿßŸàÿ≤ ÿßŸàÿ≤€åŸÖŸá\n.ÿßŸÖ€åÿØ ÿ®ÿ±ŸÑŸÜ ŸÇÿßÿ±€å ÿ®ÿßÿ¥ŸÑ€åŸÖ ÿ®ŸàŸÑÿß⁄ÜŸÇÿ∫Ÿá\nÿßŸàÿ≤ ÿßŸàÿ≤€åŸÖŸá\nÿåÿ™ŸÑ€åŸÖ ÿ®ŸàŸÑŸàÿ±ÿ∫Ÿá ŸÖ€åŸÜ ÿßŸÜÿ≥ÿßŸÜ ÿπŸÑ€å\n.ÿ™ŸÑ€å ⁄©Ÿà⁄≠ŸÑŸÖ ÿ™ÿπÿßŸÑ€å ÿ®ÿßŸÑÿ™ŸàÿßŸÑ€å\n⁄©Ÿà⁄≠ŸÑŸÖ ÿ®ÿ±ŸÑŸÜ ÿ≥Ÿà€åŸá‚ÄåŸÖ ÿ®ÿÆÿ™ŸÜ ÿ™ÿßÿ™ÿßÿ±ŸÜ⁄≠\n⁄©Ÿàÿ±ÿ±⁄ØŸá ÿ¨ÿßŸÜŸÑ€åŸÑŸÇ ŸàŸÇÿ™ŸÜ ÿ™ÿßÿ™ÿßÿ±ŸÜ⁄≠\n.ÿ™ÿßÿ™ÿßÿ± ÿ®ÿÆÿ™€å ÿßŸà⁄ÜŸàŸÜ ŸÖ€åŸÜ ÿ¨ÿßŸÜ ÿ¢ÿ™ÿßÿ±ŸÖŸÜ\n.ÿ™ÿßÿ™ÿßÿ± ÿ®€åÿ™ ŸÖ€åŸÜ ÿßŸàÿ≤ŸÖÿØŸá ⁄ÜŸÜ ÿ™ÿßÿ™ÿßÿ±ŸÖŸÜ\nÿåÿ≠ÿ≥ÿßÿ®ÿ≥ÿ≤ ⁄©Ÿàÿ® ŸÖ€åŸÜŸÖ ŸÖŸÑÿ™⁄©Ÿá ŸàÿπÿØŸá‚ÄäŸÖ\n.ŸÇÿ±ŸÑŸÖÿßÿ≥ŸÖ€å ŸàÿßŸà€åÿå ŸàÿßŸÑŸÑŸá ÿßÿπŸÑŸÖ\n

## Error Handling::
1. If no metadata can be extracted with certainty:
   - Output an empty JSON object: {}

2. If multiple possible values exist (e.g., several titles):
   - Prefer the first clearly indicated value.
   - Do not combine or merge multiple options into one field.

3. If year of publication is given ambiguously (e.g., "circa 1980s," "not earlier than 1995"):
   - Omit `datePublished`.

5. If a field value is partially damaged or incomplete:
   - Omit the field rather than risking incorrect data.

## Reminders:
- ‚ùå Never guess or hallucinate any information.
- ‚ùå Never fabricate missing fields.
- ‚úÖ Always prioritize accuracy and certainty.

## üßæ Output Format:
üìå Output only the final clean JSON-LD object.  
üìå No explanations, no Markdown, no comments ‚Äî only raw JSON-LD.
"""

def cook_extraction_prompt(batch_from_page, batch_to_page, next_footnote_num, headers_hierarchy):
   if headers_hierarchy:
      headers_hierarchy = "\n".join(headers_hierarchy)
      headers_hierarchy =  f"headers_hierarchy = ```\n{headers_hierarchy}\n```"
   else:
      headers_hierarchy = ''
   prompt = [{"text" : EXTRACT_CONTENT_PROMPT_PRELUDE.format(_to=batch_to_page, _from=batch_from_page, next_footnote_num=next_footnote_num, headers_hierarchy=headers_hierarchy)}]

   prompt.append({"text" : EXTRACT_CONTENT_PROMPT_STATIC_BODY.format(_from=batch_from_page)})
   
   prompt.append({"text" : EXTRACT_CONTENT_PROMPT_FOOTNOTE_PART.format(next_footnote_num=next_footnote_num)})

   if batch_from_page:
      prompt.append({"text" : EXTRACT_CONTENT_PROMPT_NO_TITLE.format(headers_hierarchy=headers_hierarchy)})
   else:
      prompt.append({"text" : EXTRACT_CONTENT_PROMPT_POSSIBLE_TITLE})
      
   path_to_shots = load_inline_shots()
   with open(path_to_shots, "r") as f:
      prompt.extend(json.load(f))

   prompt.append({"text" : "Now, extract the content from according to the rules above. Return a JSON object with the extracted content."})
   return prompt

def _get_remote_file_or_upload(client, name, content=None, path=None):
   file = None
   try:
      file = client.files.get(name=name)
      print(f"File `{name}` found")
      if file and file.expiration_time and file.expiration_time - datetime.datetime.now(datetime.UTC) < datetime.timedelta(minutes=30):
        client.files.delete(name=name)
        file = None
   except ClientError as e:
      if e.code != 403:
            raise e
   
   if not file:
      print(f"Uploading file `{name}` to gemini")
      if path:
         file = path
      elif content:
         file=io.BytesIO(content.encode("utf-8"))
      else:
         raise ValueError("Expected either `path` or `content` provided")
      
      file = client.files.upload(
            file=file,
            config=types.UploadFileConfig(
                  mime_type="text/plain",
                  name=name,
            ),
         )
   return file